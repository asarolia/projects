using System.IO;
using System.Web;
using System.Web.Mvc;
using DML.Generator.Domain;
using DML.Generator.Web.Helper;
using DML.Generator.Web.Models;

namespace DML.Generator.Web.Controllers
{
    public class HomeController : BaseController
    {
        /// <summary>
        /// Files the upload.
        /// </summary>
        /// <returns></returns>
        [HttpGet]
        public ActionResult FileUpload()
        {
            FileUploadViewModel vm = new FileUploadViewModel();
            return View(vm);
        }

        /// <summary>
        /// Files the upload.
        /// </summary>
        /// <param name="excelFile">The excel file.</param>
        /// <returns></returns>
        [HttpPost]
        public ActionResult FileUpload(HttpPostedFileBase excelFile)
        {
            string fileName = string.Empty;
            string path = string.Empty;
            string filePath = string.Empty;

            FileUploadViewModel vm = new FileUploadViewModel();

            if (excelFile != null && excelFile.ContentLength > 0)
            {
                fileName = Path.GetFileName(excelFile.FileName);
                path = DMLHelper.GetDirectoryPath(Request.UserHostAddress);
                DMLHelper.CreateDirectory(path);
                filePath = DMLHelper.GetFilePath(path, fileName);
                excelFile.SaveAs(filePath);
            }

            ExcelFactory excel = new ExcelFactory(filePath);
            vm.sheetInformation = excel.ReadExcel();
            return View(vm); 
        }
    }
}
